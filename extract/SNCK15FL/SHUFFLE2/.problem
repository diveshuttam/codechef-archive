{
    "problem_code": "SHUFFLE2",
    "problem_author": "xcwgf666",
    "contest_name": "CodeChef Snackdown 2015 Finale ",
    "todo": false,
    "problem_author_html_handle": "<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FF7F00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>6&#9733;</span><span>xcwgf666</span>",
    "problem_name": "Card Shuffling",
    "source_sizelimit": "50000",
    "problem_tester_html_handle": "",
    "contest_code": "SNCK15FL",
    "is_direct_submittable": false,
    "tags": "<a class='problem-tag-small ' href='/tags/problems/crt'>crt</a>, <a class='problem-tag-small ' href='/tags/problems/permutation'>permutation</a>, <a class='problem-tag-small ' href='/tags/problems/snck15fl'>snck15fl</a>, <a class='problem-tag-small ' href='/tags/problems/splay-trees'>splay-trees</a>, <a class='problem-tag-small ' href='/tags/problems/xcwgf666'>xcwgf666</a>",
    "body": "<span class=\"solution-visible-txt\">All submissions for this problem are available.</span><h3> Read problems statements in <a target=\"_blank\" href=\"http://www.codechef.com/download/translated/SNCK15FL/mandarin/SHUFFLE2.pdf\">Mandarin Chinese </a> , <a target=\"_blank\" href=\"http://www.codechef.com/download/translated/SNCK15FL/russian/SHUFFLE2.pdf\">Russian</a> and <a target=\"_blank\" href=\"http://www.codechef.com/download/translated/SNCK15FL/vietnamese/SHUFFLE2.pdf\">Vietnamese</a></h3>\n<p>A new casino has recently opened in ChefTown - the capital of ChefLand. Amongst a lot of games, there are also a few games that are played with a pile of cards. In total, there are <b>N</b> cards in the pile. Let us enumerate them by positive integers <b>1, 2, ... , N</b> in order they appear in the pile from top to bottom.</p>\n<p>Obviously, the cards must be shuffled before the game. Our protagonist Alex, being a mathematician wants to analyze this process.</p>\n<p>According to Alex, the card shuffling process in the casino is quite similar to how we do in the real life. Namely, it consists of the following:</p>\n<ul>\n<li>The croupier takes a consecutive \"sub-pile\" of cards, starting from the <b>L<sub>1</sub></b>-th card from the top and ending at the <b>R<sub>1</sub></b>-th card from the top (both inclusive) and moves this sub-pile from the middle of the pile to the very top, not changing the order of the cards in the taken sub-pile. Then she takes a sub-pile, starting at the <b>L<sub>2</sub></b>-th card and ending this one at the <b>R<sub>2</sub></b>-th one from the top of the current pile and moves it to the top, and so on. At last, she takes a sub-pile, starting at the <b>L<sub>M</sub></b>-th card and ending this one at the <b>R<sub>M</sub></b>-th one from the top of the current pile and moves it to the top.</li>\n<li>The process, described above, repeats <b>Q</b> times.</li>\n</ul>\n\n<p>Alex wants to collect some data in order to be able to predict the order in which the cards will be lying in the pile after the shuffling, but he is not really good at working with big piles and large repetitions. So, he asks you to help him by writing a program able to do the following:</p>\n<ul>\n<li>For a given set of segments (<b>[L<sub>1</sub>, R<sub>1</sub>]</b>, <b>[L<sub>2</sub>, R<sub>2</sub>]</b>, ..., <b>[L<sub>M</sub>, R<sub>M</sub>]</b>) and a given permutation, tell the minimum <b>Q</b> such that after <b>Q</b> repetitions of the first step in the algorithm above, the permutation will look like this. It is given that this number won't ever be bigger than <b>10<sup>12</sup></b>.</li>\n<li>For a given set of segments (<b>[L<sub>1</sub>, R<sub>1</sub>]</b>, <b>[L<sub>2</sub>, R<sub>2</sub>]</b>, ..., <b>[L<sub>M</sub>, R<sub>M</sub>]</b>) and a given <b>Q</b>, tell the order of the cards after the shuffling algorithm above.</li>\n</ul>\n\n<p>Hurry up and good luck!</p>\n<h3>Input</h3>\n<p>The first line of input consists of three space separated integers <b>N</b>, <b>M</b> and <b>T</b>, where <b>N</b> is the number of the cards in the pile, <b>M</b> is the number of \"move a sub-pile to the top\" operations, and <b>T</b> corresponds to the type of the problem you'll have to solve.</p>\n<p>The following <b>M</b> lines contain the pairs of space-separated integers <b>L<sub>i</sub></b> <b>R<sub>i</sub></b>.</p>\n<p>If <b>T</b> is <b>0</b>, the next line will contain a permutation of <b>N</b> space-separated positive integers. Then, the question is: what is the minimal <b>Q</b> that should be taken such that after <b>Q</b> operations described above, the pile is equal to the given permutation.</p>\n<p>If <b>T</b> is <b>1</b>, the next line will contain a single integer <b>Q</b> denoting the number of steps you'll have to perform.</p>\n<h3>Output</h3>\n<p>If <b>T</b> is zero, output the minimal required number of steps. It is guaranteed that it won't exceed <b>10<sup>12</sup></b>. If <b>T</b> is one, output a permutation corresponding to the order of the cards in the pile after <b>Q</b> operations on a single line.</p>\n<h3>Constraints</h3>\n<ul>\n<li><b>1</b> \u2264 <b>N</b> \u2264 <b>10<sup>5</sup></b></li>\n<li><b>1</b> \u2264 <b>M</b> \u2264 <b>10<sup>5</sup></b></li>\n<li><b>0</b> \u2264 <b>Q</b> \u2264 <b>10<sup>12</sup></b></li>\n<li><b>1</b> \u2264 any number in the permutation \u2264 <b>N</b></li>\n<li><b>T</b> \u2208 <b>{0, 1}</b></li>\n<li><b>1</b> \u2264  <b>L<sub>i</sub></b> \u2264 <b>R<sub>i</sub></b> \u2264 <b>N</b></li>\n</ul>\n<h3>Example</h3>\n<pre><b>Input #1:</b>\n<tt>6 2 1\n4 6\n2 5\n4</tt>\n\n<b>Output #1:</b>\n<tt>6 5 2 1 3 4</tt>\n\n<b>Input #2:</b>\n<tt>6 2 0\n4 6\n2 5\n6 5 2 1 3 4</tt>\n\n<b>Output #2:</b>\n<tt>4</tt>\n</pre><h3>Explanation</h3>\n<p><b>Example case 1.</b> In this test case, we have <b>T = 1</b>. This means that we need to find the order of the cards after <b>Q = 4</b> operations. Let us consider it step-by-step:</p>\n<ul>\n<li><b>Initially</b>, the order of <b>N = 6</b> cards in the pile is <tt>1 2 3 4 5 6</tt>.</li>\n<li>Now, consider <b>the first step</b>. We need to perform two sub-pile moves:\n<ul>\n<li>The first moving: we need to move the last three cards in the pile to the beginning. After this operation, we obtain the following order: <tt>4 5 6 1 2 3</tt>.</li>\n<li>The second moving: we need to move four cards in between of the pile to the beginning. After this operation, we obtain the following order: <tt>5 6 1 2 4 3</tt>.</li>\n</ul>\n</li><li>Then, <b>the second step</b> takes place:\n<ul>\n<li>The first moving: we need to move the last three cards in the pile to the beginning. After this operation, we obtain the following order: <tt>2 4 3 5 6 1</tt>.</li>\n<li>The second moving: we need to move four cards in between of the pile to the beginning. After this operation, we obtain the following order: <tt>4 3 5 6 2 1</tt>.</li>\n</ul>\n</li>\n<li>Then, <b>the third step</b> takes place:\n<ul>\n<li>The first moving: we need to move the last three cards in the pile to the beginning. After this operation, we obtain the following order: <tt>6 2 1 4 3 5</tt>.</li>\n<li>The second moving: we need to move four cards in between of the pile to the beginning. After this operation, we obtain the following order: <tt>2 1 4 3 6 5</tt>.</li>\n</ul>\n</li>\n<li>Then, <b>the last step</b> takes place:\n<ul>\n<li>The first moving: we need to move the last three cards in the pile to the beginning. After this operation, we obtain the following order: <tt>3 6 5 2 1 4</tt>.</li>\n<li>The second moving: we need to move four cards in between of the pile to the beginning. After this operation, we obtain the following order: <tt>6 5 2 1 3 4</tt>.</li>\n</ul>\n</li>\n<li>So, in the end, after performing <b>4</b> steps we obtain the following order: <tt>6 5 2 1 3 4</tt>.\n</li></ul>\n\n<p><b>Example case 2</b>. In this case we have <b>T = 0</b>, this means that we will need to find the minimal number of complete steps required to obtain the order of cards, described with the permutation <tt>6 5 2 1 3 4</tt>.</p>\n<p>Let's note that moves and their order are completely the same as in the previous case. Let's recall the orders of cards after the steps:</p>\n<ul>\n<li><b>Initially</b>, the order of cards is <tt>1 2 3 4 5 6</tt>.</li>\n<li>After <b>the first step</b> the order of cards is <tt>5 6 1 2 4 3</tt>.</li>\n<li>After <b>the second step</b> the order of cards is <tt>4 3 5 6 2 1</tt>.</li>\n<li>After <b>the third step</b> the order of cards is <tt>2 1 4 3 6 5</tt>.</li>\n<li>After <b>the fourth step</b> the order of cards is <tt>6 5 2 1 3 4</tt>. This is exactly the same order as requested in the test case.</li>\n</ul>\n<p>So, for the first time, the required order appears after performing <b>4</b> steps. Thus, the answer is <b>4</b>.</p>\n",
    "category_name": "main",
    "date_added": "7-05-2015",
    "status": "success",
    "languages_supported": "C, CPP14, JAVA, PYTH, PYTH 3.6, PYPY, PAS fpc, PAS gpc, RUBY, PHP, GO, NODEJS, HASK, SCALA, D, PERL, FORT, WSPC, ADA, CAML, ICK, BF, ASM, CLPS, PRLG, ICON, SCM qobi, PIKE, ST, NICE, LUA, BASH, NEM, LISP sbcl, LISP clisp, SCM guile, ERL, TCL, PERL6, TEXT, SCM chicken, CLOJ, FS",
    "max_timelimit": "2",
    "problem_status": "unattempted",
    "editorial_url": "http://discuss.codechef.com/problems/SHUFFLE2",
    "problem_tester": null,
    "time": {
        "view_start_date": 1435390200,
        "end_date": 1435408200,
        "practice_submission_allowed": true,
        "visible_start_date": 1435408200,
        "submit_start_date": 1435390200,
        "current": 1537436225
    },
    "user": {
        "username": ""
    }
}